<!DOCTYPE html>
<html lang="en" ng-app="registrationApp">
<head>
    <meta charset="UTF-8">
    <title>User Registration</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <style>
        .registration-block {
            display: none;
        }
        .visible {
            display: block;
        }
        .centered {
            margin: 0 auto;
            max-width: 400px;
        }
        .back-button {
            margin-top: 10px;
        }
    </style>
</head>
<body ng-controller="RegistrationController">
<div class="container">
    <h1>User Registration</h1>

    <!-- Форма регистрации -->
    <form ng-submit="registerUser()">
        <div class="registration-block visible" id="userDataBlock">
            <h3>Personal Information</h3>
            <div ng-show="showErrorMessage" class="error-message">
                Необходимо заполнить все обязательные поля.
            </div>
            <div class="form-group">
                <label for="surname">Фамилия:</label>
                <input type="text" class="form-control" id="surname" ng-model="userData.surname" required>
            </div>
            <div class="form-group">
                <label for="firstName">Имя:</label>
                <input type="text" class="form-control" id="firstName" ng-model="userData.firstName" required>
            </div>
            <div class="form-group">
                <label for="lastName">Отчество:</label>
                <input type="text" class="form-control" id="lastName" ng-model="userData.secondName">
            </div>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" class="form-control" id="email" ng-model="userData.email" required>
            </div>
            <div class="form-group">
                <label for="phone">Телефон</label>
                <input type="text" class="form-control" id="phone" ng-model="userData.phone" required>
            </div>
            <div class="form-group">
                <label for="age">Возраст:</label>
                <input type="number" class="form-control" id="age" ng-model="userData.age" required min="4" max="70">
            </div>
            <div>
                <label for="roleTutor">
                <input type="radio" id="roleTutor" name="role" value="tutor" required>
                Репетитор
                </label>
            </div>
            <div>
                <label for="roleSeeker">
                    <input type="radio" id="roleSeeker" name="role" value="seeker" required>
                    Искатель репетитора
                </label>
            </div>
            <button type="button" onclick="next()">Далее</button>
        </div>
        <div class="registration-block" id="seekerBlock">
            <div class="form-group requiredChangeSeeker">
                <label for="descriptionS">Описание (макс. 250 символов):</label>
                <textarea id="descriptionS" class="form-control" ng-model="seeker.description" maxlength="250"></textarea>
            </div>
            <div class="form-group requiredChangeSeeker">
                <label for="cityS">Город:</label>
                <input type="text" class="form-control" id="cityS" ng-model="seeker.city" required>
            </div>
            <button type="button" onclick="previous()" class="back-button">Назад</button>
            <button type="button" onclick="next()">Далее</button>
        </div>
        <div class="registration-block" id="tutorBlock">
            <div class="form-group requiredChangeTutor">
                <label for="specialisation">Специализация:</label>
                <input type="text" class="form-control" id="specialisation" ng-model="tutor.specialisation" required>
            </div>
            <div class="form-group requiredChangeTutor">
                <label for="price">Цена:</label>
                <input type="number" class="form-control" id="price" ng-model="tutor.price" required>
            </div>
            <!--<div class="form-group requiredChangeTutor">
                <label for="photo">Фото:</label>
                <input type="file" id="photo" accept="image/*" ng-model="tutor.photo">
            </div>-->
            <div class="form-group requiredChangeTutor">
                <label for="description">Описание (макс. 250 символов):</label>
                <textarea id="description" class="form-control" ng-model="tutor.description" maxlength="250"></textarea>
            </div>
            <button type="button" onclick="previous()" class="back-button">Назад</button>
            <button type="button" onclick="next()">Далее</button>
        </div>
        <div class="registration-block" id="addressBlock">
            <h3>Address Information</h3>
            <div class="form-group requiredChangeTutor">
                <label for="country">Cтрана:</label>
                <input type="text" class="form-control" id="country" ng-model="address.country" required>
            </div>
            <div class="form-group requiredChangeTutor">
                <label for="city">Город:</label>
                <input type="text" class="form-control" id="city" ng-model="address.city" required>
            </div>
            <div class="form-group requiredChangeTutor">
                <label for="street">Улица (микрорайон):</label>
                <input type="text" class="form-control" id="street" ng-model="address.street" required>
            </div>
            <div class="form-group requiredChangeTutor">
                <label for="house">Дом:</label>
                <input type="text" class="form-control" id="house" ng-model="address.house" required>
            </div>
            <div class="form-group requiredChangeTutor">
                <label for="office">Офис (квартира):</label>
                <input type="text" class="form-control" id="office" ng-model="address.office" required>
            </div>
            <button type="button" onclick="previous()" class="back-button">Назад</button>
            <button type="button" onclick="next()">Далее</button>
        </div>
        <div class="registration-block" id="userBlock">
            <h3>Account Information</h3>
            <div class="form-group">
                <label for="username">Login:</label>
                <input type="text" class="form-control" id="username" ng-model="user.username" required>
            </div>
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" class="form-control" id="password" ng-model="user.password" required>
            </div>
            <button type="button" onclick="previous()" class="back-button">Назад</button>
            <button type="submit" class="btn btn-primary">Register</button>
        </div>
    </form>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.9/angular.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script>

</script>
<script>
    var blockOrder = ["userDataBlock", "seekerBlock", "tutorBlock", "addressBlock", "userBlock"];
    var currentIndex = 0;

    function showBlock(blockId) {
        for (var i = 0; i < blockOrder.length; i++) {
            var block = document.getElementById(blockOrder[i]);
            if (blockId === blockOrder[i]) {
                block.style.display = "block";
            } else {
                block.style.display = "none";
            }
        }
    }

    function next() {
        if (checkValidation(blockOrder[currentIndex])) {
            console.log(blockOrder)
            if (currentIndex === 0) {
                showSelectedBlock();
            }

            if (currentIndex < blockOrder.length - 1) {
                console.log(blockOrder)
                currentIndex++;
                showBlock(blockOrder[currentIndex]);
            }
        }
    }

    function previous() {
        if (currentIndex > 0) {
            currentIndex--;
            showBlock(blockOrder[currentIndex]);
        }
    }

    function showSelectedBlock() {
        var tutorRadio = document.getElementById("roleTutor");
        var seekerRadio = document.getElementById("roleSeeker");
        var formGroupsT = document.getElementsByClassName("requiredChangeTutor");
        var formGroupsS = document.getElementsByClassName("requiredChangeSeeker");

        if (tutorRadio.checked) {
            blockOrder = ["userDataBlock", "tutorBlock", "addressBlock", "userBlock"];

            for (var i = 0; i < formGroupsS.length; i++) {
                var inputElements = formGroupsS[i].getElementsByTagName("input");
                for (var j = 0; j < inputElements.length; j++) {
                    inputElements[j].removeAttribute("required");
                }
            }
            for (var i = 0; i < formGroupsT.length; i++) {
                var inputElements = formGroupsT[i].getElementsByTagName("input");
                for (var j = 0; j < inputElements.length; j++) {
                    inputElements[j].setAttribute("required", "required");
                }
            }
        } else if (seekerRadio.checked) {
            blockOrder = ["userDataBlock", "seekerBlock", "userBlock"];

            for (var i = 0; i < formGroupsT.length; i++) {
                var inputElements = formGroupsT[i].getElementsByTagName("input");
                for (var j = 0; j < inputElements.length; j++) {
                    inputElements[j].removeAttribute("required");
                }
            }
            for (var i = 0; i < formGroupsS.length; i++) {
                var inputElements = formGroupsS[i].getElementsByTagName("input");
                for (var j = 0; j < inputElements.length; j++) {
                    inputElements[j].setAttribute("required", "required");
                }
            }
        }
    }
</script>
<script>
    function checkValidation(id) {
        // Получение всех корневых блоков с классом 'registration-block'
        var registrationBlock = document.getElementById(id);
                // Получение всех обязательных полей внутри текущего блока
                var requiredFields = registrationBlock.querySelectorAll('input[required]');
                // Проверка каждого обязательного поля
                var isValid = true;
                for (var j = 0; j < requiredFields.length; j++) {
                    var field = requiredFields[j];
                    if (field.value === '') {
                        isValid = false;
                        field.style.borderColor = 'red'; // Выделение поля красной окантовкой
                        field.placeholder = 'Необходимо заполнить поле'; // Вывод сообщения в placeholder
                    } else {
                        field.style.borderColor = ''; // Сброс окантовки
                        field.placeholder = ''; // Сброс сообщения в placeholder
                    }
                }

                // Проверка наличия радио-кнопок внутри текущего блока
                var radioButtons = registrationBlock.querySelectorAll('input[type="radio"][required]');
                if (radioButtons.length > 0) {
                    var radioButtonsChecked = false;
                    for (var k = 0; k < radioButtons.length; k++) {
                        if (radioButtons[k].checked) {
                            radioButtonsChecked = true;
                            break;
                        }
                    }

                    // Если не выбраны радио-кнопки, выведите сообщение об ошибке
                    // Если не выбраны радио-кнопки, выведите сообщение об ошибке
                    if (!radioButtonsChecked) {
                        // Проверка наличия сообщения об ошибке
                        var existingErrorMessage = document.getElementById("errorRadioCheck");
                        if (!existingErrorMessage) {
                            var errorMessage = document.createElement('div');
                            errorMessage.id="errorRadioCheck";
                            errorMessage.className = 'error-message';
                            errorMessage.innerText = 'Необходимо выбрать вариант.';
                            errorMessage.style.color = 'red';
                            registrationBlock.insertBefore(errorMessage, registrationBlock.childNodes[registrationBlock.childNodes.length - 6]);
                        }
                        isValid = false;
                    } else {
                        // Проверка наличия сообщения об ошибке
                        var existingErrorMessage = document.getElementById("errorRadioCheck");
                        if (existingErrorMessage) {
                            existingErrorMessage.parentNode.removeChild(existingErrorMessage);
                        }
                    }
                }

                // Если не все поля заполнены, выведите сообщение об ошибке
                if (!isValid) {
                    /*var errorMessage = document.createElement('div');
                    errorMessage.className = 'error-message';
                    errorMessage.innerText = 'Необходимо заполнить все обязательные поля.';
                    registrationBlock.insertBefore(errorMessage, registrationBlock.firstChild);*/
                    return false;
                } else {
                    return true
                }
            }
</script>
<script>
    var isErrorMessageShown = false; // Переменная для отслеживания состояния подсказки об ошибке

    function handleLoginError() {
        // Получение элемента input с вводом логина
        var usernameInput = document.getElementById('username');

        // Проверка наличия уже существующей подсказки
        if (!isErrorMessageShown) {
            // Добавление красной окантовки
            usernameInput.style.borderColor = 'red';

            // Создание элемента для отображения подсказки
            var errorMessage = document.createElement('span');
            errorMessage.style.color = 'red';
            errorMessage.textContent = 'Имя пользователя уже занято';

            // Вставка элемента подсказки после input
            usernameInput.parentNode.insertBefore(errorMessage, usernameInput.nextSibling);

            isErrorMessageShown = true; // Установка флага состояния подсказки
            setTimeout(function() {
                // Моргание окантовки в течение 3 секунд
                usernameInput.style.animation = 'blink-animation 0.5s infinite alternate';

                setTimeout(function() {
                    // После 3 секунд окантовка становится красной
                    usernameInput.style.animation = '';
                    usernameInput.style.borderColor = 'red';
                }, 3000);
            }, 0);
        }
    }
</script>
</body>
</html>